---
// src/components/ProjectList.astro
import type { CollectionEntry } from "astro:content";
import { CldImage } from "astro-cloudinary";
import { getProjectLink } from "../utils/links";

interface Props {
    projects: CollectionEntry<"projects">[];
}

const { projects } = Astro.props;

function getCloudinaryId(path: string): string {
    return path.replace(/^\/images\//, "acetone/").replace(/\.[^/.]+$/, "");
}
---

<div class="projectlist">
    {
        projects
            .filter((project) => project.data.images?.length > 0)
            .map((project) => {
                const cloudinaryId = getCloudinaryId(
                    project.data.images[0].default,
                );
                const projectLink = getProjectLink(project.slug);
                return (
                    <div class="projectlist-item">
                        <a
                            class="projectlist-item-imgwrp"
                            href={projectLink}
                            style={`background-color:${project.data.backgroundColor}`}
                        >
                            <CldImage
                                src={cloudinaryId}
                                width={755}
                                height={488}
                                alt={project.data.title}
                                loading="lazy"
                                sizes="(min-width: 800px) 50vw, 100vw"
                                format="auto"
                                quality="auto"
                            />
                        </a>
                        <p class="projectlist-item-desc">
                            <a href={projectLink} class="t-lighter">
                                {project.data.title}
                            </a>
                            <br />
                            <a href={projectLink} class="t-secondary">
                                (CATEGORY)
                            </a>
                        </p>
                    </div>
                );
            })
    }
</div>
